<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="profile-part">
        <div class="profile-photo-part">
            <div class="profile-photo-box">
    <div class="profile-photo-head">
        Profile Picture
    </div>
    <div class="profile-photo-body">
        <div class="profile-photo-img">
            <img id="profile-img" src="../assets/profile-pic.png" alt="Profile">
        </div>
        <div class="profile-photo-text">
            JPG, JPEG, or PNG no larger than 5 MB
        </div>
        <div class="profile-photo-btn">
            <!-- Hidden file input for changing the image -->
            <input type="file" id="upload-input" accept="image/*" style="display:none;" onchange="handleImageUpload(event)">
            <button class="upload-image" onclick="document.getElementById('upload-input').click();">Change image</button>
            <button class="delete-img" onclick="deleteImage();">Delete image</button>
        </div>
    </div>
</div>

        </div>
        
        <div class="profile-details-part">
            <div class="profile-details-box">
                <div class="profile-details-head">
                    Account Details
                </div>
                <div class="profile-details-body">
                    <form action="" class="profile-update">
    <div class="form-group">
        <div class="form-input">
            <div class="label-edit">
                <label for="fname">First name</label>
                <i class="fa-regular fa-pen-to-square edit" onclick="editField('fname')"></i>
            </div>
            <input type="text" id="fname" value="ABC" disabled>
        </div>
        <div class="form-input">
            <div class="label-edit">
                <label for="lname">Last name</label>
                <i class="fa-regular fa-pen-to-square edit" onclick="editField('lname')"></i>
            </div>
            <input type="text" id="lname" value="XYZ" disabled>
        </div>
    </div>
    <div class="form-group">
        <div class="form-input">
            <div class="label-edit">
                <label for="email">Email</label>
                <i class="fa-regular fa-pen-to-square edit" onclick="editField('email')"></i>
            </div>
            <input type="email" id="email" value="abc@gmail.com" disabled oninput="checkEmailValidation()">
            <div id="otp-email-container" style="display: none;">
                <button type="button" onclick="getOtp('email')" id="get-otp-email" style="display: none;">Get OTP</button>
                <input type="text" id="email-otp" placeholder="Enter OTP" style="display: none;" />
                <button type="button" onclick="verifyOtp('email')" style="display: none;" id="verify-email">Verify OTP</button>
                <div id="otp-timer-email" style="display: none; margin-left: 10px;">
                    <span id="timer-email">60</span> seconds remaining
                </div>
                <button type="button" id="resend-email" onclick="resendOtp('email')" style="display: none;">Resend OTP</button>
            </div>
        </div>
        <div class="form-input">
            <div class="label-edit">
                <label for="mob">Mobile Number</label>
                <i class="fa-regular fa-pen-to-square edit" onclick="editField('mob')"></i>
            </div>
            <input type="tel" id="mob" value="9191919191" disabled oninput="checkMobileValidation()">
            <div id="otp-mob-container" style="display: none;">
                <button type="button" onclick="getOtp('mob')" id="get-otp-mob" style="display: none;">Get OTP</button>
                <input type="text" id="mob-otp" placeholder="Enter OTP" style="display: none;" />
                <button type="button" onclick="verifyOtp('mob')" style="display: none;" id="verify-mob">Verify OTP</button>
                <div id="otp-timer-mob" style="display: none; margin-left: 10px;">
                    <span id="timer-mob">60</span> seconds remaining
                </div>
                <button type="button" id="resend-mob" onclick="resendOtp('mob')" style="display: none;">Resend OTP</button>
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="form-input">
            <div class="label-edit">
                <label for="location">Location</label>
                <i class="fa-regular fa-pen-to-square edit" onclick="editField('location')"></i>
            </div>
            <input type="text" id="location" value="ABC" disabled>
        </div>
        <div class="form-input">
            <div class="label-edit">
                <label for="usertype">User Type</label>
                <i class="fa-regular fa-pen-to-square edit" onclick="editField('usertype')"></i>
            </div>
            <select id="usertype" disabled>
                <option value="admin">Admin</option>
                <option value="user">User</option>
            </select>
        </div>
    </div>
    <div class="save-button">
        <button type="button" class="save-btn" onclick="saveChanges()">Save Changes</button>
    </div>
</form>

                </div>
            </div>
        </div>
    </div>
    <script>
       let currentlyEditing = null;
let otpTimeoutEmail, otpTimeoutMobile;
let otpResendTime = 60;
let isOtpVerifiedEmail = false;
let isOtpVerifiedMobile = false;

// Enable the input field for editing
function editField(field) {
    // If there's already an ongoing edit, disable all other fields
    if (currentlyEditing && currentlyEditing !== field) {
        alert("Please finish editing the current field first.");
        return;
    }

    // If this is already being edited, cancel the edit and disable the field again
    if (currentlyEditing === field) {
        cancelEdit(field);
        return;
    }

    // Enable the field for editing
    document.getElementById(field).disabled = false;
    if (field === 'email') {
        document.getElementById("otp-email-container").style.display = 'block';
    } else if (field === 'mob') {
        document.getElementById("otp-mob-container").style.display = 'block';
    }

    // Disable other fields and set the current field as the one being edited
    currentlyEditing = field;
}

// Cancel editing of a field and revert it back to its disabled state
function cancelEdit(field) {
    document.getElementById(field).disabled = true;
    if (field === 'email') {
        document.getElementById("otp-email-container").style.display = 'none';
    } else if (field === 'mob') {
        document.getElementById("otp-mob-container").style.display = 'none';
    }

    // Reset OTP timers and resend button
    stopOtpTimer('email');
    stopOtpTimer('mob');
    currentlyEditing = null;
}

// Check if email is valid and show the Get OTP button
function checkEmailValidation() {
    const emailInput = document.getElementById('email').value;
    const getOtpButton = document.getElementById('get-otp-email');

    if (validateEmail(emailInput)) {
        getOtpButton.style.display = 'inline-block';
    } else {
        getOtpButton.style.display = 'none';
    }
}

// Check if mobile is valid and show the Get OTP button
function checkMobileValidation() {
    const mobileInput = document.getElementById('mob').value;
    const getOtpButton = document.getElementById('get-otp-mob');

    if (validateMobile(mobileInput)) {
        getOtpButton.style.display = 'inline-block';
    } else {
        getOtpButton.style.display = 'none';
    }
}

// Get OTP if the input email or mobile is valid
function getOtp(type) {
    let inputField = document.getElementById(type);
    let inputValue = inputField.value;

    // Show OTP input and button
    document.getElementById(`${type}-otp`).style.display = 'inline-block';
    document.getElementById(`verify-${type}`).style.display = 'inline-block';
    startOtpTimer(type);

    // Hide Get OTP button after clicking
    document.getElementById(`get-otp-${type}`).style.display = 'none';
}

// Start OTP timer (60 seconds countdown)
function startOtpTimer(type) {
    let timerDisplay, resendButton;
    if (type === 'email') {
        timerDisplay = document.getElementById('timer-email');
        resendButton = document.getElementById('resend-email');
    } else if (type === 'mob') {
        timerDisplay = document.getElementById('timer-mob');
        resendButton = document.getElementById('resend-mob');
    }

    let countdown = otpResendTime;
    timerDisplay.textContent = countdown;
    resendButton.style.display = 'none';

    if (type === 'email') {
        otpTimeoutEmail = setInterval(() => {
            countdown--;
            timerDisplay.textContent = countdown;
            if (countdown <= 0) {
                clearInterval(otpTimeoutEmail);
                resendButton.style.display = 'inline-block';
            }
        }, 1000);
    } else {
        otpTimeoutMobile = setInterval(() => {
            countdown--;
            timerDisplay.textContent = countdown;
            if (countdown <= 0) {
                clearInterval(otpTimeoutMobile);
                resendButton.style.display = 'inline-block';
            }
        }, 1000);
    }
}

// Stop OTP timer
function stopOtpTimer(type) {
    if (type === 'email') {
        clearInterval(otpTimeoutEmail);
    } else if (type === 'mob') {
        clearInterval(otpTimeoutMobile);
    }
}

// Resend OTP when the timer reaches zero
function resendOtp(type) {
    otpResendTime = 60;
    startOtpTimer(type);
    alert(`OTP for ${type} resent!`);
}

// Verify OTP entered by the user
function verifyOtp(type) {
    let otpField = document.getElementById(type + '-otp');
    let otpValue = otpField.value;

    if (otpValue === "123456") {  // Simulate OTP validation
        alert(`${type.charAt(0).toUpperCase() + type.slice(1)} OTP verified successfully!`);
        otpField.disabled = true;

        // Update the email/mobile number with the new value
        let newValue = document.getElementById(type).value;
        document.getElementById(type).value = newValue;
        document.getElementById(`${type}-otp`).style.display = 'none';
        document.getElementById(`verify-${type}`).style.display = 'none';
    } else {
        alert('Invalid OTP');
    }
}

// Save changes function
function saveChanges() {
    let firstName = document.getElementById("fname").value;
    let lastName = document.getElementById("lname").value;
    let email = document.getElementById("email").value;
    let mobile = document.getElementById("mob").value;
    let location = document.getElementById("location").value;
    let userType = document.getElementById("usertype").value;

    alert(`Changes Saved:
    First Name: ${firstName}
    Last Name: ${lastName}
    Email: ${email}
    Mobile: ${mobile}
    Location: ${location}
    User Type: ${userType}`);

    // Disable all fields and reset editing
    cancelEdit('fname');
    cancelEdit('lname');
    cancelEdit('email');
    cancelEdit('mob');
    cancelEdit('location');
    cancelEdit('usertype');
}

// Helper functions to validate email and mobile
function validateEmail(email) {
    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    return emailRegex.test(email);
}

function validateMobile(mobile) {
    const mobileRegex = /^\d{10}$/;
    return mobileRegex.test(mobile);
}


// profile image
// Default profile image (if user deletes the image)
const defaultImage = '../assets/profile-pic.png';

// Handle image upload
function handleImageUpload(event) {
    const file = event.target.files[0]; // Get the selected file
    const profileImage = document.getElementById('profile-img');

    if (file) {
        // Validate image file type
        const validTypes = ['image/jpeg', 'image/png', 'image/jpg'];
        if (!validTypes.includes(file.type)) {
            alert('Please upload an image in JPG, JPEG, or PNG format.');
            event.target.value = ''; // Reset the file input
            return;
        }

        // Validate image size (5MB limit)
        const maxSize = 5 * 1024 * 1024; // 5 MB in bytes
        if (file.size > maxSize) {
            alert('The image size should not exceed 5 MB.');
            event.target.value = ''; // Reset the file input
            return;
        }

        // Create a new object URL for the image to display it
        const reader = new FileReader();
        reader.onload = function (e) {
            profileImage.src = e.target.result; // Update the image source to the uploaded image
        };
        reader.readAsDataURL(file); // Read the uploaded file
    }
}

// Handle delete image
function deleteImage() {
    const profileImage = document.getElementById('profile-img');

    // Reset to default profile image
    profileImage.src = defaultImage;

    // Optionally, reset the file input to empty as well
    document.getElementById('upload-input').value = ''; 
}

    </script>
</body>
</html>