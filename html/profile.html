<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="profile-part">
        <div class="profile-photo-part">
            <div class="profile-photo-box">
                <div class="profile-photo-head">
                    Profile Picture
                </div>
                <div class="profile-photo-body">
                    <div class="profile-photo-img">
                        <!-- Default profile picture -->
                        <img id="profile-img" src="../assets/profile.jpg" alt="Profile">
                    </div>
                    <div class="profile-photo-text">
                        JPG, JPEG, or PNG no larger than 5 MB
                    </div>
                    <div class="profile-photo-btn">
                        <!-- Hidden file input for changing the image -->
                        <input type="file" id="upload-input" accept="image/*" style="display:none;" onchange="handleImageUpload(event)">
                        
                        <!-- Change Image Button -->
                        <button id="change-btn" class="upload-image" onclick="document.getElementById('upload-input').click();">Change image</button>
                        
                        <!-- Delete Image Button -->
                        <button id="delete-btn" class="delete-img" onclick="deleteImage();">Delete image</button>
                    </div>
                </div>
            </div>
            

        </div>
        
        <div class="profile-details-part">
            <div class="profile-details-box">
                <div class="profile-details-head">
                    Account Details
                </div>
                <div class="profile-details-body">
                    <form action="" class="profile-update">
                        <div class="form-group">
                            <div class="form-input">
                                <div class="label-edit">
                                    <label for="fname">First name</label>
                                    <i class="fa-regular fa-pen-to-square edit" onclick="editField('fname')"></i>
                                </div>
                                <input type="text" id="fname" value="ABC" disabled>
                            </div>
                            <div class="form-input">
                                <div class="label-edit">
                                    <label for="lname">Last name</label>
                                    <i class="fa-regular fa-pen-to-square edit" onclick="editField('lname')"></i>
                                </div>
                                <input type="text" id="lname" value="XYZ" disabled>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="form-input">
                                <div class="label-edit">
                                    <label for="email">Email</label>
                                    <i class="fa-regular fa-pen-to-square edit" onclick="editField('email')"></i>
                                </div>
                                <input type="email" id="email" value="abc@gmail.com" disabled oninput="checkEmailValidation()">
                                <div id="otp-email-container" style="display: none;">
                                    <button type="button" onclick="getOtp('email')" id="get-otp-email" style="display: none;">Get OTP</button>
                                    <input type="text" id="email-otp" placeholder="Enter OTP" style="display: none;" />
                                    <button type="button" onclick="verifyOtp('email')" style="display: none;" id="verify-email">Verify OTP</button>
                                    <div id="otp-timer-email" style="display: none; margin-left: 10px;">
                                        <span id="timer-email">60</span> seconds remaining
                                    </div>
                                    <button type="button" id="resend-email" onclick="resendOtp('email')" style="display: none;">Resend OTP</button>
                                </div>
                            </div>
                            <div class="form-input">
                                <div class="label-edit">
                                    <label for="mob">Mobile Number</label>
                                    <i class="fa-regular fa-pen-to-square edit" onclick="editField('mob')"></i>
                                </div>
                                <input type="tel" id="mob" value="9191919191" disabled oninput="checkMobileValidation()">
                                <div id="otp-mob-container" style="display: none;">
                                    <button type="button" onclick="getOtp('mob')" id="get-otp-mob" style="display: none;">Get OTP</button>
                                    <input type="text" id="mob-otp" placeholder="Enter OTP" style="display: none;" />
                                    <button type="button" onclick="verifyOtp('mob')" style="display: none;" id="verify-mob">Verify OTP</button>
                                    <div id="otp-timer-mob" style="display: none; margin-left: 10px;">
                                        <span id="timer-mob">60</span> seconds remaining
                                    </div>
                                    <button type="button" id="resend-mob" onclick="resendOtp('mob')" style="display: none;">Resend OTP</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="form-input">
                                <div class="label-edit">
                                    <label for="location">Location</label>
                                    <i class="fa-regular fa-pen-to-square edit" onclick="editField('location')"></i>
                                </div>
                                <input type="text" id="location" value="ABC" disabled>
                            </div>
                            <div class="form-input">
                                <div class="label-edit">
                                    <label for="usertype">User Type</label>
                                    <i class="fa-regular fa-pen-to-square edit" onclick="editField('usertype')"></i>
                                </div>
                                <select id="usertype" disabled>
                                    <option value="admin">Admin</option>
                                    <option value="user">User</option>
                                </select>
                            </div>
                        </div>
                        <div class="save-button">
                            <button type="button" class="save-btn" onclick="saveChanges()">Save Changes</button>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
    <script>
       let currentlyEditing = null;
let otpTimeoutEmail, otpTimeoutMobile;
let otpResendTime = 60;
let isOtpVerifiedEmail = false;
let isOtpVerifiedMobile = false;

function editField(field) {
    if (currentlyEditing && currentlyEditing !== field) {
        alert("Please finish editing the current field first.");
        return;
    }

    if (currentlyEditing === field) {
        cancelEdit(field);
        return;
    }

    // Enable the field for editing
    document.getElementById(field).disabled = false;
    if (field === 'email') {
        document.getElementById("otp-email-container").style.display = 'block';
    } else if (field === 'mob') {
        document.getElementById("otp-mob-container").style.display = 'block';
    }

    currentlyEditing = field;
}

function cancelEdit(field) {
    document.getElementById(field).disabled = true;
    if (field === 'email') {
        document.getElementById("otp-email-container").style.display = 'none';
    } else if (field === 'mob') {
        document.getElementById("otp-mob-container").style.display = 'none';
    }

    stopOtpTimer('email');
    stopOtpTimer('mob');
    currentlyEditing = null;
}

function checkEmailValidation() {
    const emailInput = document.getElementById('email').value;
    const getOtpButton = document.getElementById('get-otp-email');

    if (validateEmail(emailInput)) {
        getOtpButton.style.display = 'inline-block';
    } else {
        getOtpButton.style.display = 'none';
    }
}

function checkMobileValidation() {
    const mobileInput = document.getElementById('mob').value;
    const getOtpButton = document.getElementById('get-otp-mob');

    if (validateMobile(mobileInput)) {
        getOtpButton.style.display = 'inline-block';
    } else {
        getOtpButton.style.display = 'none';
    }
}

function getOtp(type) {
    let inputField = document.getElementById(type);
    let inputValue = inputField.value;

    document.getElementById(`${type}-otp`).style.display = 'inline-block';
    document.getElementById(`verify-${type}`).style.display = 'inline-block';
    startOtpTimer(type);

    document.getElementById(`get-otp-${type}`).style.display = 'none';
}

// Start OTP timer (60 seconds countdown)
function startOtpTimer(type) {
    let timerDisplay, resendButton;
    if (type === 'email') {
        timerDisplay = document.getElementById('timer-email');
        resendButton = document.getElementById('resend-email');
    } else if (type === 'mob') {
        timerDisplay = document.getElementById('timer-mob');
        resendButton = document.getElementById('resend-mob');
    }

    let countdown = otpResendTime;
    timerDisplay.textContent = countdown;
    resendButton.style.display = 'none';

    if (type === 'email') {
        otpTimeoutEmail = setInterval(() => {
            countdown--;
            timerDisplay.textContent = countdown;
            if (countdown <= 0) {
                clearInterval(otpTimeoutEmail);
                resendButton.style.display = 'inline-block';
            }
        }, 1000);
    } else {
        otpTimeoutMobile = setInterval(() => {
            countdown--;
            timerDisplay.textContent = countdown;
            if (countdown <= 0) {
                clearInterval(otpTimeoutMobile);
                resendButton.style.display = 'inline-block';
            }
        }, 1000);
    }
}

// Stop OTP timer
function stopOtpTimer(type) {
    if (type === 'email') {
        clearInterval(otpTimeoutEmail);
    } else if (type === 'mob') {
        clearInterval(otpTimeoutMobile);
    }
}

// Resend OTP when the timer reaches zero
function resendOtp(type) {
    otpResendTime = 60;
    startOtpTimer(type);
    alert(`OTP for ${type} resent!`);
}

function verifyOtp(type) {
    let otpField = document.getElementById(type + '-otp');
    let otpValue = otpField.value;

    if (otpValue === "123456") {  // Simulate OTP validation edit this while adding functionlity
        alert(`${type.charAt(0).toUpperCase() + type.slice(1)} OTP verified successfully!`);
        otpField.disabled = true;

        let newValue = document.getElementById(type).value;
        document.getElementById(type).value = newValue;
        document.getElementById(`${type}-otp`).style.display = 'none';
        document.getElementById(`verify-${type}`).style.display = 'none';
    } else {
        alert('Invalid OTP');
    }
}

function saveChanges() {
    let firstName = document.getElementById("fname").value;
    let lastName = document.getElementById("lname").value;
    let email = document.getElementById("email").value;
    let mobile = document.getElementById("mob").value;
    let location = document.getElementById("location").value;
    let userType = document.getElementById("usertype").value;

    alert(`Changes Saved:
    First Name: ${firstName}
    Last Name: ${lastName}
    Email: ${email}
    Mobile: ${mobile}
    Location: ${location}
    User Type: ${userType}`);

    // Disable all fields and reset editing
    cancelEdit('fname');
    cancelEdit('lname');
    cancelEdit('email');
    cancelEdit('mob');
    cancelEdit('location');
    cancelEdit('usertype');
}

function validateEmail(email) {
    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    return emailRegex.test(email);
}

function validateMobile(mobile) {
    const mobileRegex = /^\d{10}$/;
    return mobileRegex.test(mobile);
}


// profile image code
const uploadInput = document.getElementById('upload-input');
const profileImg = document.getElementById('profile-img');
const changeBtn = document.getElementById('change-btn');
const deleteBtn = document.getElementById('delete-btn');

// Path for the default profile image
const defaultImagePath = '../assets/profile.jpg'; // Update this to your actual path

// Function to handle image upload
function handleImageUpload(event) {
    const file = event.target.files[0];
    
    if (!file) {
        alert('No file selected.');
        return;
    }
    
    // Validate file type (JPG, JPEG, PNG)
    const validTypes = ['image/jpeg', 'image/png'];
    if (!validTypes.includes(file.type)) {
        alert('Invalid file type. Please upload a JPG, JPEG, or PNG file.');
        return;
    }

    // Validate file size (max 5 MB)
    if (file.size > 5 * 1024 * 1024) {
        alert('File size exceeds the 5 MB limit. Please upload a smaller file.');
        return;
    }

    // Create a URL for the uploaded image and set it to the profile image
    const reader = new FileReader();
    reader.onload = function(e) {
        profileImg.src = e.target.result;
        showDeleteOption();
    };
    reader.readAsDataURL(file);
}

// Function to delete the image and revert to default
function deleteImage() {
    // Revert to default image
    profileImg.src = defaultImagePath;
    showUploadOption();
}

// Show the delete button and change "Upload Image" to "Change Image"
function showDeleteOption() {
    deleteBtn.style.display = 'inline-block'; // Show delete button
    changeBtn.textContent = 'Change Image'; // Change button text to "Change Image"
}

// Show only the "Upload Image" button when the profile image is deleted
function showUploadOption() {
    deleteBtn.style.display = 'none'; // Hide delete button
    changeBtn.textContent = 'Upload Image'; // Change button text to "Upload Image"
}

// Initial state: If there's no profile image, show the upload option
if (profileImg.src === defaultImagePath) {
    showUploadOption();
} else {
    showDeleteOption();
}


    </script>
</body>
</html>